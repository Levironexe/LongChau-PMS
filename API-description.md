# Long Ch√¢u Pharmacy API - Updated RBAC & Warehouse Endpoint Guide

## üè• What Each Endpoint Does

**Base URL:** `https://longchau-pms.onrender.com/api/`

---

## üè¢ Branch Management

| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/branches/` | GET | Get all pharmacy branches |
| `/branches/` | POST | Add a new pharmacy branch |
| `/branches/{id}/` | GET | Get details of one specific branch |
| `/branches/{id}/` | PUT | Update entire branch information |
| `/branches/{id}/` | PATCH | Update some branch information |
| `/branches/{id}/` | DELETE | Delete a branch |
| `/branches/{id}/staff-summary/` | GET | Get staff count by role for branch |
| `/branches/{id}/inventory-overview/` | GET | Get comprehensive inventory overview for a branch |
| `/branch-configs/` | GET | Get all branch settings |
| `/branch-configs/` | POST | Add settings for a branch |
| `/branch-configs/{id}/` | GET | Get specific branch configuration |
| `/branch-configs/{id}/` | PUT/PATCH | Update branch settings |
| `/branch-configs/{id}/` | DELETE | Delete branch configuration |

---

## üë• Unified User Management (RBAC)

### Main User Endpoints
| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/users/` | GET | Get all users (staff and customers) |
| `/users/` | POST | Add a new user (any role) |
| `/users/{id}/` | GET | Get details of one user |
| `/users/{id}/` | PUT/PATCH | Update user information |
| `/users/{id}/` | DELETE | Remove a user |
| `/users/?role={role}` | GET | Filter users by specific role (e.g., `pharmacist`, `customer`) |

### Factory Method Endpoints
| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/users/create-pharmacist/` | POST | Create pharmacist with proper defaults |
| `/users/create-customer/` | POST | Create customer with proper defaults |
| `/users/create-vip-customer/` | POST | Create VIP customer with benefits |
| `/users/create-staff/` | POST | Create any staff member by role |

### Role-Based Filter Endpoints
| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/users/pharmacists/` | GET | Get all pharmacists only |
| `/users/customers/` | GET | Get all customers (regular + VIP) |
| `/users/staff/` | GET | Get all staff members |

### User Profile Management
| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/user-profiles/` | GET | Get all user profiles |
| `/user-profiles/` | POST | Add profile for a user |
| `/user-profiles/{id}/` | GET | Get specific user profile |
| `/user-profiles/{id}/` | PUT/PATCH | Update user profile |
| `/user-profiles/{id}/` | DELETE | Delete user profile |
| `/users/{id}/upgrade-to-vip/` | POST | Upgrade customer to VIP status |

### Loyalty Points
| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/loyalty-points/` | GET | Get all loyalty point records |
| `/loyalty-points/` | POST | Award points to customer |
| `/loyalty-points/{id}/` | GET | Get specific loyalty point record |
| `/loyalty-points/{id}/` | PUT/PATCH | Update loyalty points |
| `/loyalty-points/{id}/` | DELETE | Delete loyalty point record |

### Authentication Endpoints (NEW)
| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/auth/login/` | POST | User login with username/password |
| `/auth/register/` | POST | Register new user account |
| `/auth/change-password/` | POST | Change user password |

---

## üì¶ Warehouse Management (NEW)

### Warehouse Endpoints
| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/warehouses/` | GET | Get all warehouses |
| `/warehouses/` | POST | Add a new warehouse |
| `/warehouses/{id}/` | GET | Get details of one warehouse |
| `/warehouses/{id}/` | PUT/PATCH | Update warehouse information |
| `/warehouses/{id}/` | DELETE | Delete a warehouse |
| `/warehouses/{id}/inventory-status/` | GET | Get comprehensive warehouse inventory overview |

### Warehouse Inventory Endpoints
| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/warehouse-inventory/` | GET | Get all warehouse stock records |
| `/warehouse-inventory/` | POST | Add stock tracking for a product in warehouse |
| `/warehouse-inventory/{id}/` | GET | Get specific warehouse inventory record |
| `/warehouse-inventory/{id}/` | PUT/PATCH | Update warehouse stock levels |
| `/warehouse-inventory/{id}/` | DELETE | Delete warehouse inventory record |
| `/warehouse-inventory/add-stock/` | POST | Add stock to warehouse from suppliers |
| `/warehouse-inventory/low-stock/` | GET | Get low stock items in warehouse |

### Warehouse Transactions
| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/warehouse-transactions/` | GET | Get all warehouse stock movements |
| `/warehouse-transactions/` | POST | Record warehouse stock movement |
| `/warehouse-transactions/{id}/` | GET | Get specific warehouse transaction |
| `/warehouse-transactions/{id}/` | PUT/PATCH | Update warehouse transaction |
| `/warehouse-transactions/{id}/` | DELETE | Delete warehouse transaction |

### Inventory Transfers
| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/inventory-transfers/` | GET | Get all transfer records |
| `/inventory-transfers/` | POST | Create a new transfer record |
| `/inventory-transfers/{id}/` | GET | Get specific transfer record |
| `/inventory-transfers/{id}/` | PUT/PATCH | Update transfer record |
| `/inventory-transfers/{id}/` | DELETE | Delete transfer record |
| `/transfers/request/` | POST | Request stock transfer from warehouse to branch |
| `/transfers/{id}/approve/` | POST | Approve transfer request |
| `/transfers/{id}/complete/` | POST | Complete approved transfer |
| `/transfers/pending/` | GET | Get pending transfer requests |

---

## üíä Product Management

| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/medicines/` | GET | Get all medicines |
| `/medicines/` | POST | Add a new medicine |
| `/medicines/{id}/` | GET | Get details of one medicine |
| `/medicines/{id}/` | PUT/PATCH | Update medicine information |
| `/medicines/{id}/` | DELETE | Remove a medicine |
| `/prescription-medicines/` | GET | Get all prescription medicines |
| `/prescription-medicines/` | POST | Mark a medicine as prescription-only |
| `/prescription-medicines/{id}/` | GET | Get specific prescription medicine |
| `/prescription-medicines/{id}/` | PUT/PATCH | Update prescription medicine |
| `/prescription-medicines/{id}/` | DELETE | Delete prescription medicine |
| `/otc-medicines/` | GET | Get all over-the-counter medicines |
| `/otc-medicines/` | POST | Mark a medicine as over-the-counter |
| `/otc-medicines/{id}/` | GET | Get specific OTC medicine |
| `/otc-medicines/{id}/` | PUT/PATCH | Update OTC medicine |
| `/otc-medicines/{id}/` | DELETE | Delete OTC medicine |
| `/supplements/` | GET | Get all health supplements |
| `/supplements/` | POST | Add a new supplement |
| `/supplements/{id}/` | GET | Get specific supplement |
| `/supplements/{id}/` | PUT/PATCH | Update supplement information |
| `/supplements/{id}/` | DELETE | Delete supplement |
| `/medical-devices/` | GET | Get all medical devices |
| `/medical-devices/` | POST | Add a new medical device |
| `/medical-devices/{id}/` | GET | Get specific medical device |
| `/medical-devices/{id}/` | PUT/PATCH | Update device information |
| `/medical-devices/{id}/` | DELETE | Delete medical device |
| `/medicine-database/` | GET | Get all medicine database entries |
| `/medicine-database/` | POST | Add a new medicine database entry |
| `/medicine-database/{id}/` | GET | Get specific medicine database entry |
| `/medicine-database/{id}/` | PUT/PATCH | Update medicine database entry |
| `/medicine-database/{id}/` | DELETE | Delete medicine database entry |

---

## üì¶ Inventory Management

| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/inventory-records/` | GET | Get stock levels for all products at branches |
| `/inventory-records/` | POST | Add stock tracking for a product at a branch |
| `/inventory-records/{id}/` | GET | Get specific inventory record |
| `/inventory-records/{id}/` | PUT/PATCH | Update stock levels |
| `/inventory-records/{id}/` | DELETE | Delete inventory record |
| `/inventory/low-stock/` | GET | Get products with low stock at branches |
| `/inventory/branch-status/` | GET | Get comprehensive branch inventory status |
| `/inventory-transactions/` | GET | Get all branch stock movements (in/out) |
| `/inventory-transactions/` | POST | Record branch stock movement (performed by User) |
| `/inventory-transactions/{id}/` | GET | Get specific branch inventory transaction |
| `/inventory-transactions/{id}/` | PUT/PATCH | Update branch inventory transaction |
| `/inventory-transactions/{id}/` | DELETE | Delete branch inventory transaction |

---

## üõí Unified Order Management

### Unified Order System
| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/orders/` | GET | Get all orders (all types) |
| `/orders/` | POST | Create any type of order |
| `/orders/{id}/` | GET | Get details of one order |
| `/orders/{id}/` | PUT/PATCH | Update order information |
| `/orders/{id}/` | DELETE | Cancel an order |
| `/orders/?order_type={type}` | GET | Filter orders by type (e.g., `prescription`, `in_store`, `online`) |

### State Pattern Endpoints
| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/orders/{id}/transition/` | POST | Change order status safely |
| `/orders/{id}/available-transitions/` | GET | Get valid status transitions |

### Strategy Pattern Endpoints
| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/orders/{id}/process/` | POST | Process order using type-specific strategy |
| `/orders/{id}/calculate-total/` | GET | Calculate total using strategy pattern |

### Order Items
| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/order-items/` | GET | Get all items in orders |
| `/order-items/` | POST | Add an item to an order |
| `/order-items/{id}/` | GET | Get specific order item |
| `/order-items/{id}/` | PUT/PATCH | Update order item |
| `/order-items/{id}/` | DELETE | Delete order item |

---

## üìã Prescription Management

| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/prescriptions/` | GET | Get all doctor prescriptions |
| `/prescriptions/` | POST | Submit a new prescription |
| `/prescriptions/{id}/` | GET | Get details of one prescription |
| `/prescriptions/{id}/` | PUT/PATCH | Update prescription |
| `/prescriptions/{id}/` | DELETE | Delete prescription |
| `/prescriptions/{id}/validate/` | POST | Pharmacist validates prescription |
| `/prescription-items/` | GET | Get all medicine items in prescriptions |
| `/prescription-items/` | POST | Add a medicine to a prescription |
| `/prescription-items/{id}/` | GET | Get specific prescription item |
| `/prescription-items/{id}/` | PUT/PATCH | Update prescription medicine |
| `/prescription-items/{id}/` | DELETE | Delete prescription item |

---

## üöö Unified Delivery Management

### Unified Delivery System
| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/deliveries/` | GET | Get all deliveries (pickup + home) |
| `/deliveries/` | POST | Schedule any type of delivery |
| `/deliveries/{id}/` | GET | Get details of one delivery |
| `/deliveries/{id}/` | PUT/PATCH | Update delivery information |
| `/deliveries/{id}/` | DELETE | Delete delivery |
| `/deliveries/{id}/schedule/` | POST | Assign staff to delivery |
| `/deliveries/?delivery_type={type}` | GET | Filter deliveries by type (e.g., `pickup`, `home`) |

---

## üè≠ Factory Pattern & Reports

### Factory Pattern Endpoints
| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/factory/create-medicine/` | POST | Create medicine using Factory Pattern |
| `/factory/create-supplement/` | POST | Create supplement using Factory Pattern |
| `/product-factories/` | GET | Get all product factories |
| `/product-factories/` | POST | Add a new factory |
| `/product-factories/{id}/` | GET | Get specific product factory |
| `/product-factories/{id}/` | PUT/PATCH | Update product factory |
| `/product-factories/{id}/` | DELETE | Delete product factory |

### Report Generation
| **Endpoint** | **Method** | **What It Does** |
|-------------|------------|------------------|
| `/reports/` | GET | Get all generated reports |
| `/reports/` | POST | Create a new report |
| `/reports/{id}/` | GET | Get specific report |
| `/reports/{id}/` | PUT/PATCH | Update report |
| `/reports/{id}/` | DELETE | Delete report |
| `/reports/sales/` | POST | Generate sales report |
| `/reports/staff-performance/` | POST | Generate staff performance report |
| `/reports/inventory/` | POST | Generate inventory report |
| `/reports/warehouse/` | POST | Generate warehouse report |

---

## üéØ MAJOR API CHANGES from Previous Version

### üî¥ REMOVED Endpoints (Old Separate User Types)
```
‚ùå /api/customers/           ‚Üí ‚úÖ /api/users/?role=customer
‚ùå /api/vip-customers/       ‚Üí ‚úÖ /api/users/?role=vip_customer
‚ùå /api/pharmacists/         ‚Üí ‚úÖ /api/users/?role=pharmacist
‚ùå /api/technicians/         ‚Üí ‚úÖ /api/users/?role=technician
‚ùå /api/managers/            ‚Üí ‚úÖ /api/users/?role=manager
‚ùå /api/cashiers/            ‚Üí ‚úÖ /api/users/?role=cashier
‚ùå /api/inventory-managers/  ‚Üí ‚úÖ /api/users/?role=inventory_manager
```

### üî¥ REMOVED Endpoints (Old Separate Order Types)
```
‚ùå /api/prescription-orders/ ‚Üí ‚úÖ /api/orders/?order_type=prescription
‚ùå /api/instore-orders/      ‚Üí ‚úÖ /api/orders/?order_type=in_store
‚ùå /api/online-orders/       ‚Üí ‚úÖ /api/orders/?order_type=online
```

### üî¥ REMOVED Endpoints (Old Separate Delivery Types)
```
‚ùå /api/pickup-deliveries/   ‚Üí ‚úÖ /api/deliveries/?delivery_type=pickup
‚ùå /api/home-deliveries/     ‚Üí ‚úÖ /api/deliveries/?delivery_type=home
```

### üÜï NEW Endpoints (RBAC, Warehouse, Authentication, Design Patterns)
```
‚úÖ /api/users/create-pharmacist/       ‚Üí Factory Method Pattern
‚úÖ /api/users/create-customer/         ‚Üí Factory Method Pattern
‚úÖ /api/users/create-vip-customer/     ‚Üí Factory Method Pattern
‚úÖ /api/users/create-staff/            ‚Üí Factory Method Pattern
‚úÖ /api/orders/{id}/transition/        ‚Üí State Pattern
‚úÖ /api/orders/{id}/process/           ‚Üí Strategy Pattern
‚úÖ /api/factory/create-medicine/       ‚Üí Factory Pattern
‚úÖ /api/factory/create-supplement/     ‚Üí Factory Pattern
‚úÖ /api/reports/staff-performance/     ‚Üí Uses unified User model
‚úÖ /api/reports/warehouse/             ‚Üí Warehouse report
‚úÖ /api/warehouses/                    ‚Üí Manage warehouses
‚úÖ /api/warehouses/{id}/inventory-status/ ‚Üí Warehouse inventory overview
‚úÖ /api/warehouse-inventory/           ‚Üí Warehouse stock records
‚úÖ /api/warehouse-inventory/add-stock/ ‚Üí Add stock to warehouse
‚úÖ /api/warehouse-inventory/low-stock/ ‚Üí Low warehouse stock items
‚úÖ /api/warehouse-transactions/        ‚Üí Warehouse transaction history
‚úÖ /api/inventory-transfers/           ‚Üí Manage inventory transfers
‚úÖ /api/transfers/request/             ‚Üí Request warehouse-to-branch transfer
‚úÖ /api/transfers/{id}/approve/        ‚Üí Approve transfer
‚úÖ /api/transfers/{id}/complete/       ‚Üí Complete transfer
‚úÖ /api/transfers/pending/             ‚Üí Get pending transfers
‚úÖ /api/auth/login/                    ‚Üí User login
‚úÖ /api/auth/register/                 ‚Üí User registration
‚úÖ /api/auth/change-password/          ‚Üí Change password
```

---

## üìù Quick Migration Guide

### Frontend Code Changes Required:

#### User Management (Before ‚Üí After)
```javascript
// OLD API calls
GET /api/customers/           ‚Üí GET /api/users/?role=customer
GET /api/pharmacists/         ‚Üí GET /api/users/?role=pharmacist
POST /api/pharmacists/        ‚Üí POST /api/users/create-pharmacist/

// NEW unified approach
GET /api/users/pharmacists/   ‚Üí Get pharmacists (shortcut)
GET /api/users/customers/     ‚Üí Get customers (shortcut)
POST /api/users/create-vip-customer/ ‚Üí Factory method
POST /api/auth/login/         ‚Üí Authenticate user
POST /api/auth/register/      ‚Üí Create user account
POST /api/auth/change-password/ ‚Üí Update password
```

#### Order Management (Before ‚Üí After)
```javascript
// OLD API calls
GET /api/prescription-orders/ ‚Üí GET /api/orders/?order_type=prescription
POST /api/instore-orders/     ‚Üí POST /api/orders/ (with order_type: 'in_store')

// NEW unified + patterns
POST /api/orders/{id}/transition/  ‚Üí Safe status changes
POST /api/orders/{id}/process/     ‚Üí Strategy-based processing
GET /api/orders/{id}/calculate-total/ ‚Üí Strategy-based total calculation
```

#### Delivery Management (Before ‚Üí After)
```javascript
// OLD API calls
GET /api/pickup-deliveries/   ‚Üí GET /api/deliveries/?delivery_type=pickup
POST /api/home-deliveries/    ‚Üí POST /api/deliveries/ (with delivery_type: 'home')

// NEW unified
POST /api/deliveries/{id}/schedule/ ‚Üí Assign unified User as staff
```

#### Warehouse Management (NEW)
```javascript
// NEW warehouse endpoints
GET /api/warehouses/                  ‚Üí Get all warehouses
POST /api/warehouse-inventory/add-stock/ ‚Üí Add stock to warehouse
GET /api/warehouse-inventory/low-stock/ ‚Üí Check low stock
POST /api/transfers/request/          ‚Üí Request warehouse-to-branch transfer
POST /api/transfers/{id}/approve/     ‚Üí Approve transfer
GET /api/transfers/pending/           ‚Üí View pending transfers
```

---

## üîß API Architecture Benefits

### 1. Simplified Endpoints
- **Before:** 15+ user management endpoints, separate order/delivery types
- **After:** Unified user, order, and delivery endpoints with role/type filtering
- **Benefit:** Easier frontend development, consistent patterns

### 2. Design Pattern Integration
- **Factory Methods:** Safe object creation with validation
- **State Pattern:** Safe order status transitions
- **Strategy Pattern:** Flexible order processing

### 3. Role-Based Filtering
- **Single endpoint** with role parameters instead of multiple endpoints
- **Consistent response format** across all user types
- **Easier API maintenance** and documentation

### 4. Warehouse System
- **Comprehensive inventory tracking** across supplier, warehouse, branch, and customer
- **Automated transfer workflows** for efficient stock management
- **Detailed reporting** for warehouse operations

### 5. Authentication
- **Secure login/registration** with password hashing and account locking
- **Role-based permissions** ensure proper access control

### 6. Backward Compatibility
- **Shortcut endpoints** like `/users/pharmacists/` for convenience
- **Filter parameters** maintain similar functionality
- **Response format** remains consistent for frontend compatibility

This updated API structure reflects the RBAC architecture, warehouse system, and design pattern features, making it robust and developer-friendly! üéØ